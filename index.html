<!DOCTYPE html>

<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Flappy Bird + Quiz ‚Äì Official</title>
<style>
  :root { --w: 420px; --h: 680px; --fg: #222; }
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
       background:linear-gradient(180deg,#b3e5fc 0%, #e1f5fe 60%, #ffffff 100%);display:flex;justify-content:center;align-items:center;min-height:100vh;}
  .wrap{width:var(--w);max-width:100%;position:relative}
  canvas{width:100%;height:auto;border-radius:14px;box-shadow:0 12px 28px rgba(0,0,0,.15);background:#aee3ff;}
  .hud{position:absolute;inset:0;pointer-events:none}
  .score{position:absolute;top:10px;left:12px;background:#ffffffcc;padding:8px 12px;border-radius:10px;font-weight:700;color:var(--fg);backdrop-filter:blur(6px)}
  .tip{position:absolute;top:10px;right:12px;background:#ffffffcc;padding:8px 12px;border-radius:10px;color:#555;font-size:14px}
  .center{position:absolute;inset:0;display:flex;align-items:center;justify-content:center}
  .overlay{pointer-events:auto;background:#ffffffee;border-radius:16px;box-shadow:0 12px 30px rgba(0,0,0,.2);padding:20px;max-width:92%;text-align:center}
  .overlay h2{margin:0 0 8px;font-size:20px}
  .overlay p{margin:6px 0 14px}
  .btn{display:inline-block;margin:6px 6px 0;padding:10px 14px;border-radius:12px;border:none;font-weight:700;cursor:pointer}
  .btn.primary{background:#0ea5e9;color:#fff}
  .btn.ghost{background:#eef6ff;color:#0b5bd3}
  .choices{display:grid;grid-template-columns:1fr;gap:8px;margin-top:8px}
  .choice{padding:10px 12px;border-radius:12px;border:2px solid #dbeafe;cursor:pointer;background:#f8fbff;font-weight:600}
  .choice.correct{border-color:#22c55e;background:#ecfdf5}
  .choice.wrong{border-color:#ef4444;background:#fef2f2}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;background:#eaf3ff;color:#0b5bd3;font-weight:700;font-size:12px}
  .footer{margin-top:10px;color:#666;font-size:12px}
  .row{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}

canvas {
    width: 100%;
    max-width: 400px;
    height: auto;
}
</style>
</head>
<body>
<div class="wrap">
<canvas aria-label="Flappy Bird Quiz" height="680" id="game" width="420"></canvas>
<div class="hud">
<div class="score">ƒêi·ªÉm: <span id="score">0</span> ‚Ä¢ ·ªêng: <span id="pipes">0</span></div>
<div class="tip">Nh·∫•n/Ch·∫°m ƒë·ªÉ bay üïπÔ∏è</div>
<div class="center" id="startScreen">
<div class="overlay">
<h2>Flappy Bird + Quiz (Official)</h2>
<p>Bay qua ·ªëng, tr·∫£ l·ªùi ƒë√∫ng. Sai l√πi 1 ·ªëng ‚Ä¢ ƒê·ª•ng ch∆∞·ªõng ng·∫°i v·∫≠t l√πi 2 ·ªëng.</p>
<div class="row">
<button class="btn primary" id="startBtn">B·∫Øt ƒë·∫ßu</button>
<button class="btn ghost" id="qrBtn">QR tr√≤ ch∆°i</button>
</div>
<p class="footer">B·ªô c√¢u h·ªèi ch√≠nh th·ª©c (10 c√¢u) ƒë√£ c√†i s·∫µn. ƒê·ªô kh√≥: D·ªÑ ‚Ä¢ C√≥ √¢m thanh.</p>
</div>
</div>
<div class="center" id="qrScreen" style="display:none">
<div class="overlay">
<h2>QR tr√≤ ch∆°i</h2>
<p>Qu√©t QR ƒë·ªÉ m·ªü tr√≤ ch∆°i tr√™n ƒëi·ªán tho·∫°i.</p>
<img alt="QR code" id="qrImg" style="width:220px;height:220px;border-radius:10px;border:1px solid #dbeafe;background:#fff"/>
<p class="footer"><input id="shareUrl" style="width:100%;padding:8px;border:1px solid #dbeafe;border-radius:8px"/></p>
<div class="row">
<button class="btn primary" id="qrClose">ƒê√≥ng</button>
<a class="btn ghost" href="scoreboard.html" target="_blank">M√†n h√¨nh ƒëi·ªÉm</a>
</div>
</div>
</div>
<div class="center" id="quizScreen" style="display:none">
<div aria-modal="true" class="overlay" role="dialog">
<div class="row" style="justify-content:space-between">
<div class="pill">C√¢u h·ªèi</div>
<div class="pill" id="timerPill" style="display:none">‚è± <span id="secLeft">0</span>s</div>
</div>
<h2 id="qText">...</h2>
<div class="choices" id="qChoices"></div>
<p class="footer" id="qNote">Sai l√πi 1 ·ªëng ‚Ä¢ ƒê√∫ng ti·∫øp t·ª•c!</p>
<p class="footer" id="explain" style="display:none"></p>
</div>
</div>
<div class="center" id="gameOver" style="display:none">
<div class="overlay">
<h2>K·∫øt th√∫c üéâ</h2>
<p>ƒêi·ªÉm c·ªßa b·∫°n: <b id="finalScore">0</b></p>
<div class="row">
<button class="btn primary" id="retryBtn">Ch∆°i l·∫°i</button>
<button class="btn ghost" id="shareBtn">Chia s·∫ª ƒëi·ªÉm</button>
<a class="btn ghost" id="submitBtn" target="_blank">G·ª≠i ƒëi·ªÉm</a>
</div>
<p class="footer">Thay li√™n k·∫øt n√∫t "G·ª≠i ƒëi·ªÉm" b·∫±ng Google Form c·ªßa b·∫°n (ch√∫ th√≠ch trong m√£).</p>
</div>
</div>
</div>
</div>
<script>
(() => {
  const CONFIG = {
    shuffleOptions: true,
    correctSpeedBoost: 1.03,
    globalTimeLimit: 0,
    showExplanationOnWrong: false,
    showExplanationOnCorrect: false,
    pipeGap: 200,
    pipeSpeed: 2.2,
    gravity: 0.42,
    spawnEvery: 135
  };

  const QUESTIONS = [
  {
    "text": "AI c√≥ th·ªÉ h·ªó tr·ª£ c√¥ng vi·ªác vƒÉn ph√≤ng nh∆∞ th·∫ø n√†o?",
    "options": [
      "T·ª± ƒë·ªông h√≥a quy tr√¨nh",
      "Vi·∫øt n·ªôi dung",
      "Ph√¢n t√≠ch d·ªØ li·ªáu",
      "T·∫•t c·∫£ c√°c ƒë√°p √°n tr√™n"
    ],
    "answerIndex": 3,
    "triggerPipe": 1
  },
  {
    "text": "Generative AI ho·∫°t ƒë·ªông d·ª±a tr√™n g√¨?",
    "options": [
      "H√¨nh ·∫£nh",
      "M√¥ h√¨nh ng√¥n ng·ªØ l·ªõn (LLM)",
      "√Çm thanh",
      "C·∫£m bi·∫øn"
    ],
    "answerIndex": 1,
    "triggerPipe": 2
  },
  {
    "text": "Hi·ªán t∆∞·ª£ng ‚Äúhallucination‚Äù trong AI l√† g√¨?",
    "options": [
      "AI kh√¥ng ph·∫£n h·ªìi",
      "AI t·∫°o ra th√¥ng tin sai l·ªách",
      "AI b·ªã treo m√°y",
      "AI kh√¥ng hi·ªÉu ng√¥n ng·ªØ"
    ],
    "answerIndex": 1,
    "triggerPipe": 3
  },
  {
    "text": "Copilot Chat ƒë·∫£m b·∫£o an to√†n d·ªØ li·ªáu b·∫±ng c√°ch n√†o?",
    "options": [
      "Kh√¥ng m√£ h√≥a d·ªØ li·ªáu",
      "D·ªØ li·ªáu ƒë∆∞·ª£c m√£ h√≥a v√† kh√¥ng d√πng ƒë·ªÉ hu·∫•n luy·ªán m√¥ h√¨nh",
      "D·ªØ li·ªáu ƒë∆∞·ª£c chia s·∫ª c√¥ng khai",
      "Kh√¥ng c√≥ bi·ªán ph√°p b·∫£o v·ªá"
    ],
    "answerIndex": 1,
    "triggerPipe": 4
  },
  {
    "text": "AI l√† vi·∫øt t·∫Øt c·ªßa c·ª•m t·ª´ n√†o sau ƒë√¢y?",
    "options": [
      "Automatic Intelligence",
      "Artificial Intelligence",
      "Advanced Interface",
      "Applied Innovation"
    ],
    "answerIndex": 1,
    "triggerPipe": 5
  },
  {
    "text": "Copilot Chat c√≥ th·ªÉ t√≠ch h·ª£p trong ·ª©ng d·ª•ng n√†o sau ƒë√¢y?",
    "options": [
      "Zalo",
      "Microsoft Teams",
      "Facebook",
      "TikTok"
    ],
    "answerIndex": 1,
    "triggerPipe": 6
  },
  {
    "text": "ƒêi·ªÉm kh√°c bi·ªát gi·ªØa Copilot Chat v√† c√°c chatbot AI th√¥ng th∆∞·ªùng l√† g√¨?",
    "options": [
      "Copilot Chat kh√¥ng c·∫ßn t√†i kho·∫£n",
      "Copilot Chat t√≠ch h·ª£p d·ªØ li·ªáu doanh nghi·ªáp v√† b·∫£o m·∫≠t theo ch√≠nh s√°ch Microsoft 365",
      "Copilot Chat ch·ªâ ho·∫°t ƒë·ªông tr√™n ƒëi·ªán tho·∫°i",
      "Copilot Chat kh√¥ng th·ªÉ x·ª≠ l√Ω file ƒë√≠nh k√®m"
    ],
    "answerIndex": 1,
    "triggerPipe": 7
  },
  {
    "text": "Giai ƒëo·∫°n cao nh·∫•t trong h√†nh tr√¨nh ·ª©ng d·ª•ng AI l√† g√¨?",
    "options": [
      "AI ‚Äì tr·ª£ l√Ω th√¥ng minh",
      "AI ‚Äì ƒë·ªìng nghi·ªáp s·ªë",
      "AI ‚Äì c√¥ng c·ª• t·ª± ƒë·ªông h√≥a",
      "AI ‚Äì ng∆∞·ªùi thay th·∫ø con ng∆∞·ªùi"
    ],
    "answerIndex": 2,
    "triggerPipe": 8
  },
  {
    "text": "Trong Microsoft 365 Copilot Chat, ‚ÄúAgents‚Äù c√≥ vai tr√≤ g√¨?",
    "options": [
      "L√† c√°c nh√¢n vi√™n h·ªó tr·ª£ tr·ª±c tuy·∫øn",
      "L√† c√°c ·ª©ng d·ª•ng AI t√πy ch·ªânh ƒë·ªÉ t·ª± ƒë·ªông h√≥a t√°c v·ª•",
      "L√† c√¥ng c·ª• ƒë·ªÉ t·∫°o h√¨nh ·∫£nh",
      "L√† n∆°i l∆∞u tr·ªØ d·ªØ li·ªáu ng∆∞·ªùi d√πng"
    ],
    "answerIndex": 1,
    "triggerPipe": 9
  },
  {
    "text": "Copilot Chat c√≥ th·ªÉ s·ª≠ d·ª•ng d·ªØ li·ªáu t·ª´ ƒë√¢u ƒë·ªÉ t·∫°o ph·∫£n h·ªìi?",
    "options": [
      "Ch·ªâ t·ª´ d·ªØ li·ªáu n·ªôi b·ªô c·ªßa Microsoft",
      "T·ª´ Internet, d·ªØ li·ªáu doanh nghi·ªáp, v√† c√°c t·ªáp ng∆∞·ªùi d√πng t·∫£i l√™n",
      "T·ª´ m·∫°ng x√£ h·ªôi c√° nh√¢n",
      "T·ª´ d·ªØ li·ªáu c·ªßa c√°c ·ª©ng d·ª•ng kh√¥ng thu·ªôc Microsoft"
    ],
    "answerIndex": 1,
    "triggerPipe": 10
  }
];

  const SFX = (() => {
    const ctx = window.AudioContext ? new AudioContext() : null;
    function tone(freq=440, dur=0.12, type='sine', vol=0.2, pitchSlide=0) {
      if (!ctx) return;
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = type;
      o.frequency.value = freq;
      g.gain.value = 0.0001;
      o.connect(g); g.connect(ctx.destination);
      const now = ctx.currentTime;
      g.gain.exponentialRampToValueAtTime(vol, now + 0.02);
      if (pitchSlide) o.frequency.exponentialRampToValueAtTime(Math.max(40, freq + pitchSlide), now + dur);
      g.gain.exponentialRampToValueAtTime(0.0001, now + dur);
      o.start();
      o.stop(now + dur + 0.02);
    }
    return {
      flap(){ tone(700,0.08,'square',0.12,-200); },
      hit(){ tone(120,0.25,'sawtooth',0.18,-60); tone(60,0.25,'triangle',0.12); },
      correct(){ tone(660,0.10,'square',0.18,80); setTimeout(()=>tone(880,0.12,'square',0.18,60),90); },
      wrong(){ tone(200,0.15,'sawtooth',0.16,-100); },
    };
  })();

  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;
  let running = false, pausedForQuiz = false, gameEnded = false;
  let bird = { x: 100, y: H/2, r: 16, vy: 0 };
  let gravity = CONFIG.gravity, flapV = -7.2;
  let pipes = [];
  let pipeGap = CONFIG.pipeGap;
  let pipeW = 70;
  let pipeSpeed = CONFIG.pipeSpeed;
  let spawnEvery = CONFIG.spawnEvery;
  let frame = 0;
  let score = 0, passed = 0;
  let invulFrames = 0;

  const scoreEl = document.getElementById('score');
  const pipesEl = document.getElementById('pipes');

  const quizScreen = document.getElementById('quizScreen');
  const qText = document.getElementById('qText');
  const qChoices = document.getElementById('qChoices');
  const qNote = document.getElementById('qNote');
  const explain = document.getElementById('explain');
  const timerPill = document.getElementById('timerPill');
  const secLeftEl = document.getElementById('secLeft');

  const startScreen = document.getElementById('startScreen');
  const qrScreen = document.getElementById('qrScreen');
  const startBtn = document.getElementById('startBtn');
  const qrBtn = document.getElementById('qrBtn');
  const qrImg = document.getElementById('qrImg');
  const shareUrl = document.getElementById('shareUrl');
  const qrClose = document.getElementById('qrClose');

  const gameOver = document.getElementById('gameOver');
  const retryBtn = document.getElementById('retryBtn');
  const shareBtn = document.getElementById('shareBtn');
  const submitBtn = document.getElementById('submitBtn');
  const finalScore = document.getElementById('finalScore');

  let quizIndex = 0;
  let timerId = null;
  let secondsLeft = 0;

  function openQR() {
    const url = location.href;
    shareUrl.value = url;
    const enc = encodeURIComponent(url);
    qrImg.src = `https://chart.googleapis.com/chart?cht=qr&chs=220x220&chl=${enc}`;
    startScreen.style.display = "none";
    qrScreen.style.display = "flex";
  }

  function stopTimer() { if (timerId) { clearInterval(timerId); timerId = null; } }
  function startTimer(totalSec, onTimeout) {
    stopTimer();
    if (!totalSec || totalSec <= 0) { timerPill.style.display = 'none'; return; }
    secondsLeft = totalSec;
    secLeftEl.textContent = secondsLeft;
    timerPill.style.display = 'inline-flex';
    timerId = setInterval(() => {
      secondsLeft--;
      secLeftEl.textContent = secondsLeft;
      if (secondsLeft <= 0) { stopTimer(); onTimeout?.(); }
    }, 1000);
  }

  function maybeShowQuiz() {
    if (quizIndex >= QUESTIONS.length) return;
    const current = QUESTIONS[quizIndex];
    if (passed >= current.triggerPipe && !pausedForQuiz) {
      pausedForQuiz = true; running = false;
      showQuiz(current);
    }
  }

  function showQuiz(q) {
    qText.textContent = q.text;
    qChoices.innerHTML = '';
    explain.style.display = 'none';
    explain.textContent = '';
    qNote.textContent = 'Sai l√πi 1 ·ªëng ‚Ä¢ ƒê√∫ng ti·∫øp t·ª•c!';
    const opts = q.options.map((t, i) => ({t, i}));
    const order = CONFIG.shuffleOptions ? opts.sort(() => Math.random() - 0.5) : opts;
    order.forEach(({t, i}) => {
      const btn = document.createElement('button');
      btn.className = 'choice';
      btn.textContent = t;
      btn.onclick = () => handleAnswer(i === q.answerIndex, q, btn);
      qChoices.appendChild(btn);
    });
    const limit = q.timeLimit && q.timeLimit > 0 ? q.timeLimit : CONFIG.globalTimeLimit;
    startTimer(limit, () => handleAnswer(false, q, null, true));
    quizScreen.style.display = "flex";
  }

  function handleAnswer(correct, q, btnClicked, isTimeout=false) {
    if (btnClicked) btnClicked.classList.add(correct ? 'correct' : 'wrong');
    if (!correct) {
      SFX.wrong();
      if (isTimeout) qNote.textContent = 'H·∫øt gi·ªù!';
      passed = Math.max(0, passed - 1);
      if (score > 0) score--;
      scoreEl.textContent = String(score);
      pipesEl.textContent = String(passed);
      qChoices.animate([{ transform: 'translateX(0)' }, { transform: 'translateX(-6px)' }, { transform: 'translateX(6px)' }, { transform: 'translateX(0)' }], { duration: 220 });
      return;
    } else {
      SFX.correct();
      stopTimer();
      setTimeout(() => {
        quizScreen.style.display = "none";
        quizIndex++;
        pausedForQuiz = false; running = true;
        pipeSpeed *= CONFIG.correctSpeedBoost || 1;
        loop();
      }, 250);
    }
  }

  function reset() {
    running = false; pausedForQuiz = false; gameEnded = false;
    bird = { x: 100, y: H/2, r: 16, vy: 0 };
    pipes = []; frame = 0; score = 0; passed = 0; invulFrames = 0;
    pipeSpeed = CONFIG.pipeSpeed; pipeGap = CONFIG.pipeGap; gravity = CONFIG.gravity;
    quizIndex = 0;
    scoreEl.textContent = '0'; pipesEl.textContent = '0';
    startScreen.style.display = "flex";
    qrScreen.style.display = "none";
    quizScreen.style.display = "none";
    gameOver.style.display = "none";
    draw();
  }

  function start() {
    if (!running) {
      startScreen.style.display = "none";
      qrScreen.style.display = "none";
      running = true;
      loop();
    }
  }

  function gameOverFlow() {
    running = false; gameEnded = true;
    finalScore.textContent = score.toString();
    gameOver.style.display = "flex";
    stopTimer();
    const FORM_URL = "https://docs.google.com/forms/d/e/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/viewform?usp=pp_url&entry.1111111111=PLAYER_NAME&entry.2222222222=SCORE";
    const url = FORM_URL
      .replace("PLAYER_NAME", encodeURIComponent(prompt("Nh·∫≠p t√™n (tu·ª≥ ch·ªçn):", "") || "Kh√¥ng t√™n"))
      .replace("SCORE", encodeURIComponent(String(score)));
    submitBtn.href = url;
  }

  function backOffPipes(n=2) {
    const before = passed;
    passed = Math.max(0, passed - n);
    const delta = before - passed;
    score = Math.max(0, score - delta);
    scoreEl.textContent = String(score);
    pipesEl.textContent = String(passed);
    bird.y = Math.max(60, Math.min(H-60, bird.y));
    bird.vy = -3;
    pipes = pipes.filter(p => p.x + pipeW < bird.x - 10);
    invulFrames = 45;
  }

  function loop() {
    if (!running) return;
    update();
    draw();
    requestAnimationFrame(loop);
  }

  function update() {
    frame++;
    if (frame % spawnEvery === 0) {
      const minGapY = 120, maxGapY = H - 160;
      const gapY = Math.floor(Math.random() * (maxGapY - minGapY)) + minGapY;
      pipes.push({ x: W + pipeW, w: pipeW, gapY, gapH: pipeGap, scored: false });
    }
    bird.vy += gravity;
    bird.y += bird.vy;
    pipes.forEach(p => p.x -= pipeSpeed);
    while (pipes.length && pipes[0].x + pipeW < -2) pipes.shift();
    for (const p of pipes) {
      if (!p.scored && p.x + p.w < bird.x - bird.r) {
        p.scored = true; score++; scoreEl.textContent = String(score);
        passed++; pipesEl.textContent = String(passed);
        maybeShowQuiz();
      }
      const hitX = bird.x + bird.r > p.x && bird.x - bird.r < p.x + p.w;
      const topPipeBottom = p.gapY - p.gapH/2;
      const bottomPipeTop = p.gapY + p.gapH/2;
      const hitY = bird.y - bird.r < topPipeBottom || bird.y + bird.r > bottomPipeTop;
      if (hitX && hitY) {
        if (invulFrames > 0) break;
        SFX.hit();
        backOffPipes(2);
        break;
      }
    }
    if (bird.y - bird.r < 0 || bird.y + bird.r > H) {
      if (invulFrames === 0) {
        SFX.hit();
        backOffPipes(2);
        bird.y = Math.min(H - bird.r - 2, Math.max(bird.r + 2, bird.y));
      }
    }
    if (invulFrames > 0) invulFrames--;
    if (quizIndex >= QUESTIONS.length && score >= QUESTIONS.length + 2) {
      gameOverFlow();
    }
  }

  function draw() {
    ctx.fillStyle = '#aee3ff'; ctx.fillRect(0,0,W,H);
    drawCloud(70,120, 28); drawCloud(180,80, 22); drawCloud(320,150, 26); drawCloud(260,40, 18);
    pipes.forEach(p => drawPipe(p));
    ctx.fillStyle = '#87cc66'; ctx.fillRect(0, H-30, W, 30);
    ctx.fillStyle = '#6bb34e'; for (let i=0;i<W;i+=16) ctx.fillRect(i, H-30, 8, 8);
    drawBird(invulFrames > 0);
    if (pausedForQuiz && !gameEnded) { ctx.fillStyle = 'rgba(0,0,0,.12)'; ctx.fillRect(0,0,W,H); }
  }

  function drawPipe(p) {
    const x = p.x, w = p.w, gapY = p.gapY, gapH = p.gapH;
    const topH = gapY - gapH/2;
    const botY = gapY + gapH/2, botH = H - botY - 30;
    ctx.fillStyle = '#2fbf71'; ctx.fillRect(x, 0, w, topH); ctx.fillRect(x, botY, w, botH);
    ctx.fillStyle = '#1b9e5d'; ctx.fillRect(x-4, topH-14, w+8, 14); ctx.fillRect(x-4, botY, w+8, 14);
  }

  function drawBird(blink=false) {
    const t = performance.now();
    if (blink && Math.floor(t/100) % 2 === 0) return;
    ctx.beginPath(); ctx.fillStyle = '#ffd166'; ctx.arc(bird.x, bird.y, bird.r, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.fillStyle = '#fff'; ctx.arc(bird.x+6, bird.y-6, 5, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.fillStyle = '#222'; ctx.arc(bird.x+7, bird.y-6, 2, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = '#ff7b00'; ctx.beginPath(); ctx.moveTo(bird.x+bird.r-2, bird.y-2); ctx.lineTo(bird.x+bird.r+10, bird.y+2); ctx.lineTo(bird.x+bird.r-2, bird.y+6); ctx.closePath(); ctx.fill();
    ctx.beginPath(); ctx.fillStyle = '#f5c34e'; const flap = Math.sin(performance.now()/120) * 4; ctx.ellipse(bird.x-6, bird.y+flap, 10, 6, 0, 0, Math.PI*2); ctx.fill();
  }

  function drawCloud(cx, cy, r) {
    ctx.fillStyle = 'rgba(255,255,255,.9)';
    ctx.beginPath();
    ctx.arc(cx, cy, r, 0, Math.PI*2);
    ctx.arc(cx+r, cy+6, r*0.8, 0, Math.PI*2);
    ctx.arc(cx-r, cy+6, r*0.8, 0, Math.PI*2);
    ctx.arc(cx, cy+10, r*0.9, 0, Math.PI*2);
    ctx.fill();
  }

  function flap() {
    if (!running && !pausedForQuiz && !gameEnded && startScreen.style.display !== "none") { start(); return; }
    if (!running || pausedForQuiz || gameEnded) return;
    bird.vy = -7.2;
    SFX.flap();
  }
  canvas.addEventListener('pointerdown', flap, { passive: true });
  window.addEventListener('keydown', (e) => {
    if (e.code === 'Space' || e.code === 'ArrowUp') { e.preventDefault(); flap(); }
    if (e.code === 'Enter' && gameOver.style.display === "flex") reset();
  });

  startBtn.onclick = start;
  qrBtn.onclick = openQR;
  qrClose && (qrClose.onclick = () => { qrScreen.style.display = 'none'; startScreen.style.display = 'flex'; });
  retryBtn.onclick = () => reset();
  shareBtn.onclick = () => {
    const txt = `M√¨nh ƒë∆∞·ª£c ${score} ƒëi·ªÉm trong Flappy Bird + Quiz!`;
    if (navigator.share) navigator.share({ text: txt, title: 'Flappy Bird + Quiz' }).catch(()=>{});
    else navigator.clipboard?.writeText(txt);
  };

  reset();
})();
</script>
</body>
</html>
